<!-- src/app/components/order/order.component.html -->
<div class="order-page">
  <header class="page-header">
    <h1>üç∫ Din Ordre</h1>
    <p>Fuldf√∏r din bestilling</p>
  </header>

  <!-- Messages -->
  <div class="message success" *ngIf="success">‚úÖ {{ success }}</div>
  <div class="message error" data-testid="error-message" *ngIf="error">‚ùå {{ error }}</div>

  <!-- Cart Preview (before creating order) -->
  <section class="card cart-preview-section" data-testid="cart-preview-section" *ngIf="!currentOrder && getCartCount() > 0">
    <h2>üõí Din Kurv</h2>
    <div class="cart-items-preview">
      <div class="cart-item-preview" data-testid="cart-item-preview" *ngFor="let item of cartService.getCartItems()">
        <span class="item-name">{{ item.beer.name }}</span>
        <span class="item-qty">√ó {{ item.quantity }}</span>
        <span class="item-price">{{ item.beer.price * item.quantity }} kr</span>
      </div>
    </div>
    <div class="cart-total-preview">
      <span>Total:</span>
      <span class="total-amount">{{ getCartTotal() }} kr</span>
    </div>
    <p class="cart-note">Angiv din alder nedenfor for at forts√¶tte med bestillingen</p>
  </section>

  <!-- Create Order Form -->
  <section class="card" *ngIf="!currentOrder">
    <h2>Start Din Ordre</h2>
    <div class="form-group">
      <label for="age">Din Alder</label>
      <input type="number" id="age" data-testid="customer-age" [(ngModel)]="customerAge" min="18" max="120">
    </div>
    <div class="form-group checkbox">
      <input type="checkbox" id="student" data-testid="student-card-checkbox" [(ngModel)]="hasStudentCard">
      <label for="student">Jeg har et studiekort (10% rabat)</label>
    </div>
    <button class="btn btn-primary" data-testid="create-order-btn" (click)="createOrder()" [disabled]="isLoading">
      {{ isLoading ? 'Opretter...' : 'Start Ordre' }}
    </button>
  </section>

  <!-- Current Order -->
  <section class="card" *ngIf="currentOrder">
    <div class="order-header" data-testid="order-created">
      <h2>Ordre #{{ currentOrder.id }}</h2>
      <span class="status-badge" [ngClass]="getStatusClass(currentOrder.status)">
        {{ currentOrder.status }}
      </span>
    </div>

    <!-- Add Beer Form -->
    <div class="add-beer-form" *ngIf="canAddBeers()">
      <h3>Tilf√∏j √òl</h3>
      <div class="form-row">
        <select [(ngModel)]="selectedBeerId">
          <option [ngValue]="null">V√¶lg en √∏l...</option>
          <option *ngFor="let beer of beers" [ngValue]="beer.id">
            {{ beer.name }} - {{ beer.price }} kr
          </option>
        </select>
        <input type="number" [(ngModel)]="quantity" min="1" max="10" placeholder="Antal">
        <button class="btn btn-secondary" (click)="addBeer()" [disabled]="!selectedBeerId || isLoading">
          Tilf√∏j
        </button>
      </div>
    </div>

    <!-- Order Lines -->
    <div class="order-lines" *ngIf="orderLines.length > 0">
      <h3>Varer</h3>
      <div class="line-item" *ngFor="let line of orderLines">
        <span class="item-name">{{ line.beer.name }}</span>
        <span class="item-qty">√ó{{ line.quantity }}</span>
        <span class="item-price">{{ line.lineTotal }} kr</span>
      </div>
    </div>

    <!-- Order Summary -->
    <div class="order-summary" data-testid="order-summary">
      <div class="summary-row">
        <span>Subtotal:</span>
        <span>{{ currentOrder.totalPrice }} kr</span>
      </div>
      <div class="summary-row discount" data-testid="discount-amount" *ngIf="currentOrder.discountPercent > 0">
        <span>Rabat ({{ currentOrder.discountPercent }}%):</span>
        <span>-{{ currentOrder.totalPrice - currentOrder.finalPrice }} kr</span>
      </div>
      <div class="summary-row total" data-testid="order-total">
        <span>Total:</span>
        <span>{{ currentOrder.finalPrice }} kr</span>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="order-actions">
      <button class="btn btn-confirm" *ngIf="canConfirm()" (click)="confirmOrder()" [disabled]="isLoading">
        Bekr√¶ft Ordre
      </button>
      <button class="btn btn-pay" *ngIf="canPay()" (click)="payOrder()" [disabled]="isLoading">
        Betal Nu
      </button>
      <button class="btn btn-complete" *ngIf="canComplete()" (click)="completeOrder()" [disabled]="isLoading">
        Mark√©r Fuldf√∏r
      </button>
      <button class="btn btn-cancel" *ngIf="canCancel()" (click)="cancelOrder()" [disabled]="isLoading">
        Annuller Ordre
      </button>
    </div>
  </section>
</div>